<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MANTIS: mos/kernel/include/clock.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.3-20050530 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">mos</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000007.html">kernel</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000014.html">include</a></div>
<h1>clock.h File Reference</h1>An alarm timer implementation for the avr. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="mos_8h-source.html">mos.h</a>&quot;</code><br>
<code>#include &lt;inttypes.h&gt;</code><br>

<p>
<a href="clock_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmos__time__.html">mos_time_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A standard time struct.  <a href="structmos__time__.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmos__alarm__.html">mos_alarm_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A structure to hold an alarm.  <a href="structmos__alarm__.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="structmos__time__.html">mos_time_</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a0">mos_time_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A standard time struct.  <a href="#a0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef void(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a1">alarm_func</a> )(void *user_data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="structmos__alarm__.html">mos_alarm_</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a2">mos_alarm_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A structure to hold an alarm.  <a href="#a2"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a3">clock_init</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">ticks per second microseconds per tick Initialize the clock.  <a href="#a3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a4">mos_udelay</a> (uint16_t usec)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delay function in microseconds.  <a href="#a4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a5">mos_mdelay</a> (uint16_t msec)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delay function in milliseconds.  <a href="#a5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a6">mos_alarm</a> (<a class="el" href="structmos__alarm__.html">mos_alarm_t</a> *new, uint32_t secs, uint32_t usecs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Inserts a new alarm at the given secs and usecs from the current time.  <a href="#a6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a7">mos_alarm_ticks</a> (<a class="el" href="structmos__alarm__.html">mos_alarm_t</a> *new, uint32_t ticks)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Inserts a new alarm at the given number of ticks from the current time.  <a href="#a7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="mos_8h.html#a5">boolean</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a8">mos_remove_alarm</a> (<a class="el" href="structmos__alarm__.html">mos_alarm_t</a> *alarm)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove an alarm from the list.  <a href="#a8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a9">mos_set_time</a> (<a class="el" href="structmos__time__.html">mos_time_t</a> *tv)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the current real world time.  <a href="#a9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a10">mos_get_time</a> (<a class="el" href="structmos__time__.html">mos_time_t</a> *tv)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the current real world time.  <a href="#a10"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="clock_8h.html#a11">print_clock_list</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convenience function for printing an alarm list.  <a href="#a11"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
An alarm timer implementation for the avr. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Original Author: Jeff Rose <p>
Heavily Modified and debugged: Brian, Cyrus, Charles, Adam </dd></dl>
<dl compact><dt><b>Date:</b></dt><dd>Created: 04/20/2004 <p>
Modified: 05/25/2004</dd></dl>

<p>
Definition in file <a class="el" href="clock_8h-source.html">clock.h</a>.<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a1"></a><!-- doxytag: member="clock.h::alarm_func" ref="a1" args=")(void *user_data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef void(* <a class="el" href="clock_8h.html#a1">alarm_func</a>)(void *user_data)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="clock_8h-source.html#l00044">44</a> of file <a class="el" href="clock_8h-source.html">clock.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2"></a><!-- doxytag: member="clock.h::mos_alarm_t" ref="a2" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef struct <a class="el" href="structmos__alarm__.html">mos_alarm_</a>  <a class="el" href="structmos__alarm__.html">mos_alarm_t</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
A structure to hold an alarm. 
<p>
An alarm is attached to a hardware timer, along with a callback function which is called when the alarm triggers. Alarms are stored in a linked list, with the relative number of ticks between each node in the list.<p>
NOTE: The callback function will be executed in an interrrupt context.    </td>
  </tr>
</table>
<a class="anchor" name="a0"></a><!-- doxytag: member="clock.h::mos_time_t" ref="a0" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef struct <a class="el" href="structmos__time__.html">mos_time_</a>  <a class="el" href="structmos__time__.html">mos_time_t</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
A standard time struct. 
<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3"></a><!-- doxytag: member="clock.h::clock_init" ref="a3" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void clock_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
ticks per second microseconds per tick Initialize the clock. 
<p>
Set the interrupt mode, set the prescaler.    </td>
  </tr>
</table>
<a class="anchor" name="a6"></a><!-- doxytag: member="clock.h::mos_alarm" ref="a6" args="(mos_alarm_t *new, uint32_t secs, uint32_t usecs)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int8_t mos_alarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structmos__alarm__.html">mos_alarm_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>new</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>uint32_t&nbsp;</td>
          <td class="mdname" nowrap> <em>secs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>uint32_t&nbsp;</td>
          <td class="mdname" nowrap> <em>usecs</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Inserts a new alarm at the given secs and usecs from the current time. 
<p>
Accounts for inserting the new alarm into the alarm list in order and adjusting the relative times of the alarm list as it is called. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>new</em>&nbsp;</td><td>New alarm to be inserted </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>secs</em>&nbsp;</td><td>Relative time in secs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>usecs</em>&nbsp;</td><td>Relative time in microseconds</td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a7"></a><!-- doxytag: member="clock.h::mos_alarm_ticks" ref="a7" args="(mos_alarm_t *new, uint32_t ticks)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int8_t mos_alarm_ticks           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structmos__alarm__.html">mos_alarm_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>new</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>uint32_t&nbsp;</td>
          <td class="mdname" nowrap> <em>ticks</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Inserts a new alarm at the given number of ticks from the current time. 
<p>
Accounts for inserting the new alarm into the alarm list in order and adjusting the relative times of the alarm list as it is called. Use this if you want to avoid conversion math. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>new</em>&nbsp;</td><td>New alarm to be inserted </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ticks</em>&nbsp;</td><td>Relative time in ticks</td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a10"></a><!-- doxytag: member="clock.h::mos_get_time" ref="a10" args="(mos_time_t *tv)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int8_t mos_get_time           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structmos__time__.html">mos_time_t</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tv</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the current real world time. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tv</em>&nbsp;</td><td>Stores real world time</td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a5"></a><!-- doxytag: member="clock.h::mos_mdelay" ref="a5" args="(uint16_t msec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void mos_mdelay           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">uint16_t&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msec</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Delay function in milliseconds. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msec</em>&nbsp;</td><td>Milliseconds to delay</td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a8"></a><!-- doxytag: member="clock.h::mos_remove_alarm" ref="a8" args="(mos_alarm_t *alarm)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="mos_8h.html#a5">boolean</a> mos_remove_alarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structmos__alarm__.html">mos_alarm_t</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>alarm</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Remove an alarm from the list. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>alarm</em>&nbsp;</td><td>Alarm to remove </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd></dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a9"></a><!-- doxytag: member="clock.h::mos_set_time" ref="a9" args="(mos_time_t *tv)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int8_t mos_set_time           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structmos__time__.html">mos_time_t</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tv</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Set the current real world time. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tv</em>&nbsp;</td><td>New time to apply</td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a4"></a><!-- doxytag: member="clock.h::mos_udelay" ref="a4" args="(uint16_t usec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void mos_udelay           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">uint16_t&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>usec</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Delay function in microseconds. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>usec</em>&nbsp;</td><td>Microseconds to delay</td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a11"></a><!-- doxytag: member="clock.h::print_clock_list" ref="a11" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void print_clock_list           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Convenience function for printing an alarm list. 
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Wed Jul 27 17:00:36 2005 for MANTIS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.3-20050530 </small></address>
</body>
</html>
